//circvis.wedge.js
vq.CircVis=function(){vq.Vis.call(this)},vq.CircVis.prototype=vq.extend(vq.Vis),vq.CircVis.prototype.draw=function(a){var b=new vq.models.CircVisData(a);b.isDataReady()?(this.chromoData=b,this._render()):console.warn("Invalid data input.  Check data for missing or improperly formatted values.")},vq.CircVis.prototype._render=function(){function r(b){a._add_wedge(b),a._drawTicks(b),a._drawNetworkNodes(b)}function g(a,b){}function f(a,b){}function e(a,b){function n(a,b){return a[0]*b[0]+a[1]*b[1]}function m(a,b){return a[0]*b[1]-a[1]*b[0]}var e=d3.transform(d3.select(this).attr("transform")),f=e.translate,g=e.scale,h=e.rotate,i=c/2*g[0],j=d/2*g[1],k=[d3.event.x-i,d3.event.y-j],l=[d3.event.x-d3.event.dx-i,d3.event.y-d3.event.dy-j],o=Math.atan2(m(l,k),n(l,k))*180/Math.PI;h+=o,d3.select(this).attr("transform","translate("+f[0]+","+f[1]+")scale("+g+")rotate("+h+")")}var a=this,b=this.chromoData,c=b._plot.width,d=b._plot.height,h=d3.behavior.drag().on("dragstart",f).on("drag",e).on("dragend",g),i=b._plot.id,j=d3.select(b._plot.container).append("svg:svg").attr("id",i).attr("width",c).attr("height",d).append("svg:g").attr("class","circvis").attr("transform","translate("+c/2+","+d/2+")").call(h);j.insert("svg:defs");var k=j.selectAll("g.ideogram").data(b._chrom.keys).enter().append("svg:g").attr("class","ideogram").attr("data-region",function(a){return a}).attr("opacity",1).attr("transform",function(a){return"rotate("+b._chrom.groups[a].startAngle*180/Math.PI+")"}).each(r),l=b._plot.height/2,m=l-b.ticks.outer_padding,n=m-b.ticks.height,o=(m+n)/2;k.append("text").attr("transform",function(a){return"rotate("+(b._chrom.groups[a].endAngle-b._chrom.groups[a].startAngle)*180/Math.PI/2+" )translate(0,-"+o+")"}).attr("class","region_label").attr("stroke","black").attr("text-anchor","middle").attr("dy",".35em").attr("cursor","pointer").text(function(a){return a}).each(function(){$(this).disableSelection()}).on("mouseover",function(a){var c={},d=b.normalizedLength[a],e=1-d,f=_.size(b.normalizedLength);_.each(b.normalizedLength,function(a,b,d){c[b]=a/e/2}),c[a]=.5});if(!_.isNull(b._chrom.radial_grid_line_width)&&b._chrom.radial_grid_line_width>0){var q=b._network.network_radius;k.selectAll("path.radial_lines").data(function(a){return[[{x:0,y:-1*m},{x:0,y:-1*q[a]}]]}).enter().insert("svg:path",".wedges").attr("class","radial_lines").attr("d",d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"))}a._drawNetworkLinks(j.insert("svg:g",".ideogram").attr("class","links")),_(_.range(0,b._wedge.length)).each(function(b){a._draw_axes_ticklabels(b),a._insertRingClipping(b)})},vq.CircVis.prototype._drawWedgeContents=function(a,b){var c=this,d=c.chromoData,e=d._ideograms[a],f=d3.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+b+'"]'),g=d._wedge[b];switch(g._plot_type){case"karyotype":case"tile":case"band":case"heatmap":case"glyph":this._drawWedgeData(a,b);break;default:this._drawWedge_withRange(a,b)}},vq.CircVis.prototype._insertRingClipping=function(a){var b=this.chromoData._wedge[a]._outerRadius,c=this.chromoData._wedge[a]._innerRadius,d=d3.svg.arc()({innerRadius:c,outerRadius:b,startAngle:0,endAngle:2*Math.PI});d3.select("svg .circvis defs").append("svg:clipPath").attr("id","ring_clip_"+a).append("svg:path").attr("d",d)},vq.CircVis.prototype._add_wedge=function(a){function h(d){var e=d3.select(this),f=c._wedge[d];if(f._plot_type!="karyotype"&&f._plot_type!="tile"&&f._plot_type!="band"&&f._plot_type!="glyph"){if(isNaN(f._min_plotValue)||isNaN(f._max_plotValue)){console.warn("Range of values for ring with index ("+d+") not detected.  Data has not been plotted.");return}f._min_plotValue==f._max_plotValue&&(f._min_plotValue=f._min_plotValue-1,f._max_plotValue=f._max_plotValue+1,console.warn("Invalid value range detected.  Range reset to [-1,1]."))}b._drawWedgeContents(a,d)}function f(a){return c._wedge[a]._innerRadius}function e(a){return c._wedge[a]._outerPlotRadius}var b=this,c=this.chromoData,d=d3.select('.ideogram[data-region="'+a+'"]'),g=d.append("svg:g").attr("class","wedges").selectAll("path").data(_.range(0,c._wedge.length)).enter().append("svg:g").attr("class","wedge").attr("clip-path",function(a){return"url(#ring_clip_"+a+")"}).attr("data-ring",function(a){return a});g.append("svg:path").attr("class","background").attr("d",d3.svg.arc().innerRadius(function(a){return f(a)}).outerRadius(function(a){return e(a)}).startAngle(0).endAngle(c._chrom.groups[a].angle)),g.append("svg:g").attr("class","data"),d.selectAll("g.wedge").each(h)},vq.CircVis.prototype._drawWedge_withoutRange=function(a,b){var c=this,d=c.chromoData,e=d._ideograms[a],f=d._wedge[b],g=e.wedge[b]},vq.CircVis.prototype._drawWedge_withRange=function(a,b){var c=this,d=c.chromoData,e=d._ideograms[a],f=d._wedge[b],g=e.wedge[b],h=d3.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+b+'"]');if(f._draw_axes){var i=d._chrom.groups[a],j=i.startAngle,k=i.angle,l=f._y_linear.ticks(4);h.append("svg:g").attr("class","axes").selectAll("path").data(l).enter().append("svg:path").style("fill","#ddd").style("stroke","#555").style("stroke-width","1.0px").attr("d",d3.svg.arc().innerRadius(function(a){return f._y_linear(a)}).outerRadius(function(a){return f._y_linear(a)}).startAngle(0).endAngle(k))}c._drawWedgeData(a,b)},vq.CircVis.prototype._drawWedgeData=function(a,b){function e(b){var d=c.chromoData._wedge[b],e="_drawWedgeData_"+d._plot_type;c[e]!==undefined&&c[e](a,b);var f=d3.selectAll('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+b+'"] .data > *');f.on("mouseover",function(a){d.hovercard.call(this,a)})}var c=this,d=_.isUndefined(b)||_.isNull(b);if(!d&&_.isNumber(b)&&_.isFinite(b)&&b>=c.chromoData._wedge.length)console.error("drawWedgeData: Invalid wedge #:"+b);else{if(d){_.each(_.range(0,c.chromoData._wedge.length),function(a){e.call(c,a)});return}e.call(c,b)}},vq.CircVis.prototype._drawWedgeData_barchart=function(a,b){var c=this,d=c.chromoData._wedge[b],e=c.chromoData._ideograms[a].wedge[b],f=d._value_key,g=d3.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+b+'"]'),h=function(b){var e=d._innerRadius,f=c.chromoData._ideograms[a].theta(b.start),g=c.chromoData._ideograms[a].theta(b.end);return d3.svg.arc().innerRadius(e).startAngle(f).endAngle(g)},i=g.select("g.data").selectAll("path").data(e,c.chromoData._network.node_key);i.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("stroke-width",d._lineWidth).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).transition().duration(800).attrTween("d",function(a){var b=d3.interpolate({outerRadius:d._innerRadius},{outerRadius:d._thresholded_outerRadius(a[f])}),c=h(a);return function(a){return c(b(a))}}).style("fill-opacity",1).style("stroke-opacity",1),i.exit().transition().duration(800).attrTween("d",function(a){var b=d3.interpolate({outerRadius:d._thresholded_outerRadius(a[f])},{outerRadius:d._innerRadius}),c=h(a);return function(a){return c(b(a))}}).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},vq.CircVis.prototype._drawWedgeData_histogram=vq.CircVis.prototype._drawWedgeData_barchart,vq.CircVis.prototype._drawWedgeData_scatterplot=function(a,b){var c=this,d=c.chromoData._wedge[b],e=c.chromoData._ideograms[a].wedge[b],f=d._value_key,g=d3.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+b+'"]'),h=g.select("g.data").selectAll("path").data(e,c.chromoData._network.node_key);h.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("transform",function(b){return"rotate("+(c.chromoData._ideograms[a].theta(b.start)*180/Math.PI-90)+")translate("+d._thresholded_value_to_radius(b[f])+")"}).attr("d",d3.svg.symbol().type(d._shape).size(Math.pow(d._radius(),2))).transition().duration(800).style("fill-opacity",1).style("stroke-opacity",1),h.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},vq.CircVis.prototype._drawWedgeData_line=function(a,b){var c=this,d=c.chromoData._wedge[b],e=_.sortBy(c.chromoData._ideograms[a].wedge[b],"start"),f=d._value_key,g=d3.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+b+'"]'),h=d3.svg.line.radial().interpolate("basis").tension(.8).radius(function(a){return d._thresholded_value_to_radius(a[f])}).angle(function(b){return c.chromoData._ideograms[a].theta(b.start)}),i=g.select("g.data").selectAll("path").data([e]);i.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",h).transition().duration(800).style("stroke-opacity",1),i.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},vq.CircVis.prototype._drawWedgeData_area=function(a,b){var c=this,d=c.chromoData._wedge[b],e=_.sortBy(c.chromoData._ideograms[a].wedge[b],"start"),f=d._value_key,g=d3.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+b+'"]'),h=d3.svg.line.radial().interpolate("basis").tension(.8).radius(function(a){return d._thresholded_value_to_radius(a[f])}).angle(function(b){return c.chromoData._ideograms[a].theta(b.start)}),i=d3.svg.area.radial().interpolate("basis").tension(.8).innerRadius(function(a){return d._thresholded_innerRadius(a[f])}).outerRadius(function(a){return d._thresholded_outerRadius(a[f])}).angle(function(b){return c.chromoData._ideograms[a].theta(b.start)}),j=g.select("g.data").selectAll("path").data([e]);j.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",h).transition().duration(800).style("stroke-opacity",1),j.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",i).transition().duration(800).style("fill-opacity",.7),j.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},vq.CircVis.prototype._drawWedgeData_band=function(a,b){var c=this,d=c.chromoData._wedge[b],e=c.chromoData._ideograms[a].wedge[b],f=d._value_key,g=d3.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+b+'"]'),h=g.select("g.data").selectAll("path").data(e,c.chromoData._network.node_key);h.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",d3.svg.arc().innerRadius(d._innerRadius).outerRadius(d._outerPlotRadius).startAngle(function(b){return c.chromoData._ideograms[a].theta(b.start)}).endAngle(function(b){return c.chromoData._ideograms[a].theta(b.end)})).transition().duration(800).style("fill-opacity",1).style("stroke-opacity",1),h.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},vq.CircVis.prototype._drawWedgeData_glyph=function(a,b){var c=this,d=c.chromoData._wedge[b],e=c.chromoData._ideograms[a].wedge[b],f=d._value_key,g=d3.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+b+'"]'),h=g.select("g.data").selectAll("path").data(e,d._hash);h.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("transform",function(b){return"rotate("+(c.chromoData._ideograms[a].theta(b.start)*180/Math.PI-90)+")translate("+d._glyph_distance(b)+")"}).transition().duration(800).attr("d",d3.svg.symbol().type(d._shape).size(Math.pow(d._radius(),2))).transition().duration(800).style("fill-opacity",1).style("stroke-opacity",1),h.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},vq.CircVis.prototype._drawWedgeData_tile=function(a,b){var c=this,d=c.chromoData._wedge[b],e=c.chromoData._ideograms[a].wedge[b],f=d._value_key,g=d3.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+b+'"]'),h=g.select("g.data").selectAll("path").data(e,c.chromoData._network.node_key);h.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",d3.svg.arc().innerRadius(function(a){return d._thresholded_tile_innerRadius(a,d)}).outerRadius(function(a){return d._thresholded_tile_outerRadius(a,d)}).startAngle(function(b){return c.chromoData._ideograms[a].theta(b.start)}).endAngle(function(b){return c.chromoData._ideograms[a].theta(b.end)})).transition().duration(800).style("fill-opacity",1).style("stroke-opacity",1),h.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},vq.CircVis.prototype._drawWedgeData_karyotype=function(a,b){var c=this,d=c.chromoData._wedge[b],e=c.chromoData._ideograms[a].wedge[b],f=d._value_key,g=d3.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+b+'"]'),h=g.select("g.data").selectAll("path").data(e,c.chromoData._network.node_key);h.enter().append("svg:path").style("fill",function(a){return a[f]}).style("stroke",d._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",d3.svg.arc().innerRadius(d._innerRadius).outerRadius(d._outerPlotRadius).startAngle(function(b){return c.chromoData._ideograms[a].theta(b.start)}).endAngle(function(b){return c.chromoData._ideograms[a].theta(b.end)})).transition().duration(800).style("fill-opacity",1).style("stroke-opacity",1),h.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},vq.CircVis.prototype._drawWedgeData_heatmap=function(a,b){var c=this,d=c.chromoData._wedge[b],e=c.chromoData._ideograms[a].wedge[b],f=d._value_key,g=d3.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+b+'"]'),h=function(b){var e=c.chromoData._ideograms[a].theta(b.start),f=c.chromoData._ideograms[a].theta(b.end);return d3.svg.arc().innerRadius(function(a){return d._innerRadius-a*4}).outerRadius(function(a){return d._outerPlotRadius+a*4}).startAngle(function(a){return e-a*Math.PI/360}).endAngle(function(a){return f+a*Math.PI/360})},i=g.select("g.data").selectAll("path").data(e,c.chromoData._network.node_key);i.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("stroke-width","1px").style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",d3.svg.arc().innerRadius(d._innerRadius).outerRadius(d._outerPlotRadius).startAngle(function(b){return c.chromoData._ideograms[a].theta(b.start)}).endAngle(function(b){return c.chromoData._ideograms[a].theta(b.end)})).transition().duration(800).transition().duration(800).style("fill-opacity",1).style("stroke-opacity",1).attrTween("d",function(a){var b=d3.interpolate(4,0),c=h(a);return function(a){return c(b(a))}}),i.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},vq.CircVis.prototype._draw_axes_ticklabels=function(a){var b=this,c=b.chromoData,d=c._wedge[a];if(!!_.isFunction(d._y_linear)&&d._draw_axes){var e=d._y_linear.ticks(4);d3.select('.ideogram .wedge[data-ring="'+a+'"] .axes').append("svg:g").attr("class","labels").selectAll("g.text").data(e).enter().append("svg:text").each(function(){$(this).disableSelection()}).attr("transform",function(a){return"translate(0,-"+d._y_linear(a)+")"}).text(function(a){return a})}},vq.CircVis.prototype._drawTicks=function(a){var b=this,c=b.chromoData;if(!!c.ticks.render_ticks){var d=d3.select('.ideogram[data-region="'+a+'"]'),e=c._plot.height/2,f=e-c.ticks.outer_padding,g=f-c.ticks.height,h=c.ticks.tile_ticks?function(a){return g+a.level*c.ticks.wedge_height*1.3}:function(a){return g},i=function(a){return h(a)+c.ticks.wedge_height},j=c.ticks.label_key,k=function(a){return c.ticks.fill_style(a,j)},l=function(a){return c.ticks.stroke_style(a,j)},m=function(a){var b=p/h(a);return n(a)?b*2:b},n=function(a){return!0},o=Math.PI/180*c.ticks.wedge_width,p=o*g,q=function(a){var c=h(a),d=i(a),e=b.chromoData._ideograms[a.chr].theta(a.start),f=m(a);return d3.svg.arc().innerRadius(function(a){return c-a*4}).outerRadius(function(a){return d+a*4}).startAngle(function(a){return e-a*Math.PI/360}).endAngle(function(a){return e+f+a*Math.PI/360})},r=c._network.node_key;d.select("g.ticks").empty()&&d.append("svg:g").attr("class","ticks");var s=d.select("g.ticks").selectAll("path").data(c.ticks.data_map[a],r);s.enter().append("path").attr("class",function(a){return a[j]}).style("fill",k).style("stroke",l).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).on("mouseover",function(a){d3.select("text[data-label='"+a[j]+"']").attr("visibility","visible"),c.ticks.hovercard.call(this,a)}).on("mouseout",function(a){d3.select("text[data-label='"+a[j]+"']").attr("visibility","hidden")}).transition().duration(800).attrTween("d",function(a){var b=d3.interpolate(4,0),c=q(a);return function(a){return c(b(a))}}).style("fill-opacity",1).style("stroke-opacity",1),s.exit().transition().duration(800).attrTween("d",function(a){var b=d3.interpolate(0,4),c=q(a);return function(a){return c(b(a))}}).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()}},vq.CircVis.prototype._drawNetworkNodes=function(a){var b=this.chromoData,c=b._network.tile_nodes?function(c){return b._network.network_radius[a]-c.level*2*b._network.node_radius(c)}:function(c){return b._network.network_radius[a]},d=d3.select('.ideogram[data-region="'+a+'"]');d.select("g.nodes").empty()&&d.append("svg:g").attr("class","nodes");var e=b._network.nodes_array.filter(function(b){return!b.children&&b.chr==a}),f=d.select("g.nodes").selectAll("circle.node").data(b._network.nodes_array.filter(function(b){return!b.children&&b.chr==a}),b._network.node_key),g=f.enter(),h=f.exit();g.append("svg:circle").attr("class","node").attr("cx",0).attr("cy",0).attr("r",function(a){return b._network.node_radius(a)*4}).style("fill",b._network.node_fillStyle).style("stroke",b._network.node_strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("transform",function(d){return"rotate("+(b._ideograms[a].theta(d.start)/Math.PI*180-90)+")translate("+c(d)+")"}).on("mouseover",function(a){b._network.node_hovercard.call(this,a)}).transition().duration(800).attr("r",b._network.node_radius).style("stroke-opacity",1).style("fill-opacity",1),h.transition().duration(800).attr("r",function(a){return b._network.node_radius(a)*4}).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},vq.CircVis.prototype._drawNetworkLinks=function(){var a=this.chromoData,b=d3.layout.bundle(),c=a._network.tile_nodes?function(b){return a._network.network_radius[b.chr]-b.level*2*a._network.node_radius(b)}:function(b){return a._network.network_radius[b.chr]},d=d3.svg.line.radial().interpolate("bundle").tension(.65).radius(function(a){return a.radius!==undefined?a.radius:c(a)}).angle(function(b){return b.angle!==undefined?b.angle:a._ideograms[b.chr]._feature_angle(b.start)}),e=d3.select("g.links").selectAll("path.link").data(b(a._network.links_array).map(function(b,c){return _.extend(a._network.links_array[c],{spline:b})}));e.enter().insert("svg:path").attr("class",function(a){return"link t_"+a.source.chr+" p_"+a.target.chr}).style("fill","none").style("stroke",a._network.link_strokeStyle).style("stroke-width",function(b){return a._network.link_line_width(b)*3}).style("stroke-opacity",1e-6).attr("d",function(a){return d(a.spline)}).on("mouseover",function(b){d3.select(this).style("stroke-opacity",1),a._network.link_hovercard.call(this,b)}).on("mouseout",function(b){d3.select(this).style("stroke-opacity",a._network.link_alpha(b))}).transition().duration(800).style("stroke-width",a._network.link_line_width).style("stroke-opacity",a._network.link_alpha),e.exit().transition().duration(800).style("stroke-opacity",1e-6).style("stroke-width",function(b){return a._network.link_line_width(b)*3}).remove()},vq.models.CircVisData=function(a){vq.models.VisData.call(this,a),this.setDataModel(),this.getDataType()=="vq.models.CircVisData"?this._build_data(this.getContents()):console.warn("Unrecognized JSON object.  Expected vq.models.CircVisData object.")},vq.models.CircVisData.prototype=vq.extend(vq.models.VisData),vq.models.CircVisData.prototype.setDataModel=function(){this._dataModel=[{label:"_plot.width",id:"PLOT.width",defaultValue:400},{label:"_plot.height",id:"PLOT.height",defaultValue:400},{label:"_plot.container",id:"PLOT.container",optional:!0},{label:"vertical_padding",id:"PLOT.vertical_padding",defaultValue:0},{label:"horizontal_padding",id:"PLOT.horizontal_padding",defaultValue:0},{label:"_chrom.keys",id:"GENOME.DATA.key_order",defaultValue:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","X","Y"]},{label:"_chrom.length",id:"GENOME.DATA.key_length",defaultValue:[]},{label:"_chrom.reverse_list",id:"GENOME.OPTIONS.key_reverse_list",optional:!0},{label:"_chrom.gap_degrees",id:"GENOME.OPTIONS.gap_degrees",cast:Number,defaultValue:0},{label:"_chrom.label_layout_style",id:"GENOME.OPTIONS.label_layout_style",defaultValue:"default"},{label:"_chrom.label_font_style",id:"GENOME.OPTIONS.label_font_style",cast:String,defaultValue:"16px helvetica, monospaced"},{label:"_chrom.radial_grid_line_width",id:"GENOME.OPTIONS.radial_grid_line_width",cast:Number,defaultValue:null},{label:"_chrom.listener",id:"GENOME.OPTIONS.listener",cast:Function,defaultValue:function(){return null}},{label:"_plot.enable_pan",id:"PLOT.enable_pan",cast:Boolean,defaultValue:!1},{label:"_plot.enable_zoom",id:"PLOT.enable_zoom",cast:Boolean,defaultValue:!1},{label:"_plot.show_legend",id:"PLOT.show_legend",cast:Boolean,defaultValue:!1},{label:"_plot.legend_corner",id:"PLOT.legend_corner",cast:String,defaultValue:"ne"},{label:"_plot.legend_radius",id:"PLOT.legend_radius",cast:Number,defaultValue:25},{label:"_plot.legend_show_rings",id:"PLOT.legend_show_rings",cast:Boolean,defaultValue:!0},{label:"_plot.rotate_degrees",id:"PLOT.rotate_degrees",cast:Number,defaultValue:0},{label:"_plot.tooltip_timeout",id:"PLOT.tooltip_timeout",cast:Number,defaultValue:200},{label:"_network.data",id:"NETWORK.DATA.data_array",optional:!0},{label:"_network._outer_padding",id:"NETWORK.OPTIONS.outer_padding",optional:!0},{label:"_network.node_listener",id:"NETWORK.OPTIONS.node_listener",cast:Function,defaultValue:function(){return null}},{label:"_network.link_listener",id:"NETWORK.OPTIONS.link_listener",cast:Function,defaultValue:function(){return null}},{label:"_network.link_tooltipItems",id:"NETWORK.OPTIONS.link_tooltip_items",defaultValue:{"Node 1 Chr":"sourceNode.chr","Node 1 Start":"sourceNode.start","Node1 End":"sourceNode.end","Node 2 Chr":"targetNode.chr","Node 2 Start":"targetNode.start","Node 2 End":"targetNode.end"}},{label:"_network.link_tooltipLinks",id:"NETWORK.OPTIONS.link_tooltip_links",defaultValue:{}},{label:"_network.link_line_width",id:"NETWORK.OPTIONS.link_line_width",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(a,b){return 1}},{label:"_network.link_alpha",id:"NETWORK.OPTIONS.link_alpha",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(){return.7}},{label:"_network.link_strokeStyle",id:"NETWORK.OPTIONS.link_stroke_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(){return"steelblue"}},{label:"_network.node_fillStyle",id:"NETWORK.OPTIONS.node_fill_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(){return"green"}},{label:"_network.node_radius",id:"NETWORK.OPTIONS.node_radius",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(){return 3}},{label:"_network.node_key",id:"NETWORK.OPTIONS.node_key",cast:Function,defaultValue:function(a){return a.chr}},{label:"_network.node_highlightMode",id:"NETWORK.OPTIONS.node_highlight_mode",cast:String,defaultValue:"brighten"},{label:"_network.node_tooltipFormat",id:"NETWORK.OPTIONS.node_tooltipFormat",cast:vq.utils.VisUtils.wrapProperty,defaultValue:vq.utils.VisUtils.network_node_title},{label:"_network.node_tooltipItems",id:"NETWORK.OPTIONS.node_tooltip_items",defaultValue:{Chr:"chr",Start:"start",End:"end"}},{label:"_network.node_tooltipLinks",id:"NETWORK.OPTIONS.node_tooltip_links",defaultValue:{}},{label:"_network.max_node_linkDegree",id:"NETWORK.OPTIONS.max_node_linkdegree",cast:Number,defaultValue:9999},{label:"_network.min_node_linkDegree",id:"NETWORK.OPTIONS.min_node_linkdegree",cast:Number,defaultValue:0},{label:"_network.node_overlap_distance",id:"NETWORK.OPTIONS.node_overlap_distance",cast:Number,defaultValue:12e6},{label:"_network.tile_nodes",id:"NETWORK.OPTIONS.tile_nodes",cast:Boolean,defaultValue:!1},{label:"ticks._data_array",id:"TICKS.DATA.data_array",optional:!0},{label:"ticks.tooltipItems",id:"TICKS.OPTIONS.tooltip_items",defaultValue:{Chr:"chr",Start:"start",End:"end",Label:"value"}},{label:"ticks.tooltipLinks",id:"TICKS.OPTIONS.tooltip_links",defaultValue:{}},{label:"ticks.label_map",id:"TICKS.OPTIONS.label_map",defaultValue:[{key:"",label:""}]},{label:"ticks.render_ticks",id:"TICKS.OPTIONS.render_ticks",cast:Boolean,defaultValue:Boolean(!0)},{label:"ticks.label_key",id:"TICKS.OPTIONS.label_key",defaultValue:"value",cast:String},{label:"ticks.height",id:"TICKS.OPTIONS.height",cast:Number,defaultValue:60},{label:"ticks.wedge_width",id:"TICKS.OPTIONS.wedge_width",cast:Number,defaultValue:.2},{label:"ticks.wedge_height",id:"TICKS.OPTIONS.wedge_height",cast:Number,defaultValue:10},{label:"ticks.outer_padding",id:"TICKS.OPTIONS.outer_padding",cast:Number,defaultValue:0},{label:"ticks.listener",id:"TICKS.OPTIONS.listener",cast:Function,defaultValue:function(){return null}},{label:"ticks.display_legend",id:"TICKS.OPTIONS.display_legend",cast:Boolean,defaultValue:!0},{label:"ticks.legend_corner",id:"TICKS.OPTIONS.legend_corner",cast:String,defaultValue:"nw"},{label:"ticks.tile_ticks",id:"TICKS.OPTIONS.tile_ticks",cast:Boolean,defaultValue:!0},{label:"ticks.overlap_distance",id:"TICKS.OPTIONS.overlap_distance",cast:Number,optional:!0},{label:"ticks.fill_style",id:"TICKS.OPTIONS.fill_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(){return"red"}},{label:"ticks.stroke_style",id:"TICKS.OPTIONS.stroke_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(){return"white"}},{label:"_wedge",id:"WEDGE",optional:!0}]},vq.models.CircVisData.prototype._build_data=function(a){var b=a;this._processData(b),this._wedge&&(this._wedge=this._wedge.map(function(a){return new vq.models.CircVisData.WedgeData(a)})),this._setupData()},vq.models.CircVisData.prototype._setupData=function(){var a={},b,c=[],d,e={},f,g=[],h={},i={},j=[],k=[],l={},m;this.normalizedLength,this.theta=[],this.startAngle_map={};var n=this;this._plot.id=vq.utils.VisUtils.guid();if(this._chrom.keys==[]||this._chrom.length==[])console.warn("Chromosome/Ideogram information has not been detected.  Please verify that keys and length/key mappings have been passed into the GENOME.DATA object.");else{var o=this._chrom.keys;_.each(o,function(b,c){a[b]=c}),c=this._chrom.length.filter(function(b){return a[b.chr_name]!=null}),c.sort(function(b,c){return a[b.chr_name]-a[c.chr_name]>0}),m=vq.sum(c,function(a){return a.chr_length});var p=1-this._chrom.gap_degrees*o.length/360;b={},_.each(c,function(a){b[a.chr_name.toUpperCase()]=a.chr_length,i[a.chr_name.toUpperCase()]=a.chr_length*p/m}),this.normalizedLength=i;var q={},r=this._plot.rotate_degrees*Math.PI/180,s=this._chrom.gap_degrees*Math.PI/180;_.each(o,function(c,d){e[c]=_.reduce(o.slice(0,a[c]),function(a,b,c){return a+i[o[c]]*2*Math.PI+s},0),l[c]=d3.scale.linear().domain([0,b[c.toUpperCase()]]).range([0,2*Math.PI*i[c]]),n._chrom.reverse_list!=undefined&&n._chrom.reverse_list.filter(function(a){return a==c}).length>0?l[c]=d3.scale.linear().domain([0,b[c.toUpperCase()]]).range([2*Math.PI*i[c],0]):l[c]=d3.scale.linear().domain([0,b[c.toUpperCase()]]).range([0,2*Math.PI*i[c]]),q[c]={key:c,startAngle:e[c],endAngle:e[c]+2*Math.PI*i[c],theta:l[c],angle:2*Math.PI*i[c]}}),this.theta=l,this._ideograms={},_.each(n._chrom.keys,function(a){h[a]=e[a]+r,n._ideograms[a]=_.extend(q[a],{wedge:[],_feature_angle:function(a){return this.startAngle+this.theta(a)}})}),this.startAngle_map=h,this._chrom.groups=q,this._wedge!=undefined&&_.each(this._wedge,function(a,b){if(a._plot_type=="tile"||a._plot_type=="glyph"){var c=a._tile.show_all_tiles?Math.floor((a._plot_height-a._radius()*4)/(a._tile.height+a._tile.padding)):undefined;a._data=a._plot_type=="tile"?vq.utils.VisUtils.layoutChrTiles(a._data,a._tile.overlap_distance,c):vq.utils.VisUtils.layoutChrTicks(a._data,a._tile.overlap_distance,c)}d={},_.each(a._data,function(a){d[a.chr]===undefined&&(d[a.chr]=[]),d[a.chr].push(a)}),a._chr={},_.each(n._chrom.keys,function(b){a._chr[b]=d[b]===undefined?[]:_.extend(d[b],q[b])}),a._outerRadius=n._plot.height/2-vq.sum(n._wedge.slice(0,b),function(a){return a._plot_height+a._outer_padding})-(n.ticks.outer_padding+n.ticks.height),a._outerPlotRadius=a._outerRadius-a._outer_padding,a._innerRadius=a._outerPlotRadius-a._plot_height,n._chrom.keys.forEach(function(c){n._ideograms[c]._outerRadius=n._plot.height/2-(n.ticks.outer_padding+n.ticks.height),n._ideograms[c].wedge[b]=a._chr[c]}),a.hovercard=vq.hovercard({canvas_id:n._plot.id,include_header:!1,include_footer:!0,self_hover:!0,timeout:n._plot.tooltip_timeout,data_config:a._tooltipItems,tool_config:a._tooltipLinks});if(a._plot_type!="karyotype"){var e=a._value_key;j=Math.sqrt(science.stats.variance(_.pluck(a._data,e))),k=science.stats.median(_.pluck(a._data,e)),a._min_plotValue=a._min_plotValue===undefined?parseFloat((-1*j+k).toFixed(2)):a._min_plotValue,a._max_plotValue=a._max_plotValue===undefined?parseFloat((j+k).toFixed(2)):a._max_plotValue,a._range_mean=a._base_plotValue!=null?a._base_plotValue:(a._min_plotValue+a._max_plotValue)/2,a._y_linear=d3.scale.linear().domain([a._min_plotValue,a._max_plotValue]).range([a._innerRadius,a._outerRadius-a._outer_padding]).nice(),a._y_axis=d3.scale.linear().domain([a._min_plotValue,a._max_plotValue]).range([a._innerRadius,a._outerPlotRadius]),a._thresholded_innerRadius=function(b){return Math.max(a._y_axis(Math.min(b,a._range_mean)),a._innerRadius)},a._thresholded_outerRadius=function(b){return Math.min(a._y_axis(Math.max(b,a._range_mean)),a._outerPlotRadius)},a._thresholded_value_to_radius=function(b){return Math.min(Math.max(a._y_axis(b),a._innerRadius),a._outerPlotRadius)},a._thresholded_radius=function(b){return Math.min(Math.max(b,a._innerRadius),a._outerPlotRadius)},a._thresholded_tile_innerRadius=function(b,c){return a._innerRadius+(c._tile.height+c._tile.padding)*b.level},a._thresholded_tile_outerRadius=function(b,c){return a._innerRadius+(c._tile.height+c._tile.padding)*b.level+c._tile.height},a._plot_type=="glyph"&&(a._glyph_distance=function(b){return(a._tile.height+a._tile.padding)*b.level+a._innerRadius+a._radius(b)},a._checked_endAngle=function(a,b){return n._chrom.keys.length==1?Math.min(n.startAngle_map[b]+n.theta[b](a.end||a.start+1),n.startAngle_map[n._chrom.keys[0]]+Math.PI*2):this.parent.index+1==n._chrom.keys.length?Math.min(n.startAngle_map[b]+n.theta[b](a.end||a.start+1),n.startAngle_map[n._chrom.keys[0]]+Math.PI*2):Math.min(n.startAngle_map[b]+n.theta[b](a.end||a.start+1),n.startAngle_map[n._chrom.keys[(this.parent.index+1)%n._chrom.keys.length]])}),delete a._data}});if(this.ticks!=undefined&&this.ticks._data_array!=undefined&&this.ticks._data_array!=null){if(n.ticks.overlap_distance===undefined){var t=7e6/3080419480;n.ticks.overlap_distance=t*m}var u=n.ticks.render_ticks&&n.ticks.tile_ticks?vq.utils.VisUtils.layoutChrTicks(n.ticks._data_array,n.ticks.overlap_distance):n.ticks._data_array,v={};_.each(u,function(a){v[a.chr]===undefined&&(v[a.chr]=[]),v[a.chr].push(a)}),this.ticks.data_map={},_.each(n._chrom.keys,function(a){n.ticks.data_map[a]=v[a]===undefined?[]:v[a]}),this.ticks._data_array=[],delete u,v=[],this.ticks.hovercard=vq.hovercard({canvas_id:n._plot.id,include_header:!1,include_footer:!0,self_hover:!0,timeout:n._plot.tooltip_timeout,data_config:n.ticks.tooltipItems,tool_config:n.ticks.tooltipLinks})}var w={};_.each(n._chrom.keys,function(a){w[a]={}});var x={},y=[{parent:null,chr:null,radius:0,angle:0,children:[]}];n._network.network_radius={},o.forEach(function(a,b){var c=n._ideograms[a].wedge.length>0?n._wedge[n._ideograms[a].wedge.length-1]._innerRadius:n._plot.height/2-n.ticks.outer_padding-n.ticks.height,d=n._network.network_radius[a]=c-n._network._outer_padding;x[a]=b+1;var e={chr:a,parent:y[0],children:[],radius:d/2,angle:(n._chrom.groups[a].startAngle+n._chrom.groups[a].endAngle)/2};y[0].children.push(e),y.push(e)}),this._network.node_parent_map=x,this._network.base_nodes=_.map(y,function(a){return _.extend({},a)}),this._network.data_nodes_map=Object.create(null),this._network.links_map=Object.create(null),this._network.nodes_array=y,this._network.links_array=[],this._network.link_hovercard=vq.hovercard({canvas_id
:n._plot.id,include_header:!1,include_footer:!0,self_hover:!0,timeout:n._plot.tooltip_timeout,data_config:n._network.link_tooltipItems,tool_config:n._network.link_tooltipLinks}),this._network.node_hovercard=vq.hovercard({canvas_id:n._plot.id,include_header:!1,include_footer:!0,self_hover:!0,timeout:n._plot.tooltip_timeout,data_config:n._network.node_tooltipItems,tool_config:n._network.node_tooltipLinks}),this._insertEdges(n._network.data),this.setDataReady(!0)}},vq.models.CircVisData.prototype._remove_wedge_data=function(a){var b=this,c=a.chr;_.each(this._ideograms[c].wedge,function(d,e){b._ideograms[c].wedge[e]=_.reject(d,function(c){return b.same_feature(c,a)})})},vq.models.CircVisData.prototype._add_wedge_data=function(a){var b=this,c=a.chr;_.each(this._ideograms[c].wedge,function(c,d){!_.isUndefined(a[b._wedge[d]._value_key])&&b._wedge[d]._plot_type!="karyotype"&&c.push(a)})},vq.models.CircVisData.prototype.same_feature=function(a,b){return this._network.node_key(a)==this._network.node_key(b)},vq.models.CircVisData.prototype.same_edge=function(a,b){return this.same_feature(a.source,b.source)&&this.same_feature(a.target,b.target)},vq.models.CircVisData.prototype._add_tick_data=function(a){var b=this,c;_.any(b.ticks.data_map[a.chr],function(c){return b.same_feature(c,a)})?c=_.find(b.ticks.data_map[a.chr],function(c){return b.same_feature(c,a)}):(c=a,vq.utils.VisUtils.layoutTile(c,b.ticks.data_map[c.chr].length,b.ticks.data_map[c.chr],b.ticks.overlap_distance),b.ticks.data_map[c.chr].push(c));return c},vq.models.CircVisData.prototype._add_network_node=function(a){function d(a){var d,e=b._network.data_nodes_map[b._network.node_key(a)],f=b._network.nodes_array[c[a.chr]];if(_.isUndefined(e)){d=_.extend({parent:f},a),f.children.push(d),b._network.data_nodes_map[b._network.node_key(a)]=b._network.nodes_array.push(d)-1;return d}return b._network.nodes_array[e]}var b=this,c=this._network.node_parent_map;if(_.isArray(a))return _.map(a,d,b);return d(a)},vq.models.CircVisData.prototype._remove_network_node=function(a){function c(a){var c,d=this._network.data_nodes_map[this._network.node_key(a)];_.isDefined(d)&&(b._network.nodes_array[d]=undefined,b._network.data_nodes_map[b._network.node_key(a)]=undefined)}var b=this;_.isArray(a)?_.map(a,c,b):c(a)},vq.models.CircVisData.prototype._remove_tick_data=function(a){var b=this;this.ticks.data_map[a.chr]=_.reject(this.ticks.data_map[a.chr],function(c){return b.same_feature(c,a)})},vq.models.CircVisData.prototype._insertNode=function(a){var b=this,c;if(!_.include(_.keys(b._chrom.groups),a.chr))return null;this._add_tick_data(a),c=this._add_network_node(a),this._add_wedge_data(a);return c},vq.models.CircVisData.prototype._insertNodes=function(a){var b=this,c=[],d=b.add_network_node(a);_.each(d,function(a){b._add_wedge_data(a)});return c},vq.models.CircVisData.prototype._retileNodes=function(){if(this._network.tile_nodes){var a=_.reject(this._network.nodes_array,function(a){return a.children});a=vq.utils.VisUtils.layoutChrTiles(a,this._network.node_overlap_distance),this._network.nodes_array=_.union(this._network.base_nodes,a)}},vq.models.CircVisData.prototype._removeNode=function(a){!_.isObject(a)||(this._remove_tick_data(a),this._remove_network_node(a),this._remove_wedge_data(a))},vq.models.CircVisData.prototype._insertEdges=function(a){function d(a){var c=this._network.node_key,d=a.node1,e=a.node2,f=c(d),g=c(e),h=f+"_"+g,i=this._network.links_map[h];if(_.isUndefined(i)){var j=_.extend({source:b._network.nodes_array[b._network.data_nodes_map[f]],target:b._network.nodes_array[b._network.data_nodes_map[g]]},a);this._network.links_map[h]=this._network.links_array.push(j)-1}}var b=this,c=_.flatten(_.map(a,function(a){return[a.node1,a.node2]}));this._add_network_node(c),_.map(a,d,b)},vq.models.CircVisData.prototype._insertEdge=function(a){var b=[a.node1,a.node2],c=this;if(_.any(b,function(a){return _.isNull(a)||!_.include(_.keys(c._chrom.groups),a.chr)})){console.log("Unmappable chromosome in edge.");return null}var d=c._insertNodes([b[0],b[1]]);if(_.any(d,function(a){return _.isNull(a)})){console.error("Unable to insert node for requested edge");return null}var e=_.chain(a).keys().reject(function(a){return a=="node1"||a=="node2"}).value(),f=_.chain(a).pick(e).extend({source:d[0],target:d[1]}).value();if(_.any(this._network.links_array,function(a){return c.same_edge(f,a)}))return null;this._network.links_array.push(f);return f},vq.models.CircVisData.prototype._removeEdge=function(a){var b=this;_.isObject(a)&&(this._network.links_array=_.reject(this._network.links_array,function(c){return b.same_edge(c,a)}))},vq.models.CircVisData.prototype._removeEdges=function(a){var b=this;_.isArray(a)&&(this._network.links_array=_.difference(b._network.links_array,a))},vq.models.CircVisData.WedgeData=function(a){vq.models.VisData.call(this,{CONTENTS:a}),this.setDataModel(),this._build_data(this.getContents())},vq.models.CircVisData.WedgeData.prototype=vq.extend(vq.models.VisData),vq.models.CircVisData.WedgeData.prototype.setDataModel=function(){this._dataModel=[{label:"_data",id:"DATA.data_array",defaultValue:[{chr:"1",end:12784268,start:644269,value:-0.058664}]},{label:"_value_key",id:"DATA.value_key",defaultValue:"value",cast:String},{label:"_hash",id:"DATA.hash",defaultValue:"label",cast:String},{label:"listener",id:"OPTIONS.listener",defaultValue:function(a,b){}},{label:"_plot_type",id:"PLOT.type",defaultValue:"histogram"},{label:"_plot_height",id:"PLOT.height",cast:Number,defaultValue:100},{label:"_fillStyle",id:"OPTIONS.fill_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(a){return"red"}},{label:"_strokeStyle",id:"OPTIONS.stroke_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(a){return"black"}},{label:"_lineWidth",id:"OPTIONS.line_width",cast:Number,defaultValue:.5},{label:"_shape",id:"OPTIONS.shape",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(a){return"circle"}},{label:"_radius",id:"OPTIONS.radius",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(a){return 2}},{label:"_outer_padding",id:"OPTIONS.outer_padding",cast:Number,defaultValue:1},{label:"_min_plotValue",id:"OPTIONS.min_value",cast:Number,optional:!0},{label:"_max_plotValue",id:"OPTIONS.max_value",cast:Number,optional:!0},{label:"_base_plotValue",id:"OPTIONS.base_value",cast:Number,optional:!0},{label:"_legend_label",id:"OPTIONS.legend_label",cast:String,defaultValue:""},{label:"_legend_desc",id:"OPTIONS.legend_description",cast:String,defaultValue:""},{label:"_draw_axes",id:"OPTIONS.draw_axes",cast:Boolean,defaultValue:!0},{label:"_tooltipFormat",id:"OPTIONS.tooltipFormat",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(a,b){return"Chr "+b+"\nStart: "+a.start+"\nEnd: "+a.end}},{label:"_tooltipItems",id:"OPTIONS.tooltip_items",defaultValue:{Chr:"chr",Start:"start",End:"end",Value:"value"}},{label:"_tooltipLinks",id:"OPTIONS.tooltip_links",defaultValue:{}},{label:"_tile.padding",id:"OPTIONS.tile_padding",cast:Number,defaultValue:5},{label:"_tile.overlap_distance",id:"OPTIONS.tile_overlap_distance",cast:Number,defaultValue:.1},{label:"_tile.height",id:"OPTIONS.tile_height",cast:Number,defaultValue:5},{label:"_tile.show_all_tiles",id:"OPTIONS.tile_show_all_tiles",cast:Boolean,defaultValue:!1}]},vq.models.CircVisData.WedgeData.prototype._build_data=function(a){this._processData(a)},vq.CircVis.prototype.addEdges=function(a,b){var c=_.isBoolean(b)?b:Boolean(!1),d;_.isArray(a)?d=this._insertEdges(a):d=this._insertEdges([a]),this._drawNetworkLinks();if(!c){var e=_.flatten(_.map(d,function(a){return[a.source,a.target]}));this.addNodes(e)}},vq.CircVis.prototype.removeEdges=function(a,b){var c=this,d=_.isBoolean(b)?b:Boolean(!1);a==="all"&&(a=this.chromoData._network.links_array),_.isArray(a)?_.each(a,function(a){c.chromoData._removeEdge(a)}):_.isObject(a)&&this.chromoData._removeEdge(a),this._drawNetworkLinks();if(!d){var e=this._edgeListToNodeList(a),f=this._edgeListToNodeList(this.chromoData._network.links_array),g=_.difference(e,f);this.removeNodes(g)}},vq.CircVis.prototype._insertEdges=function(a){return _.filter(_.map(a,vq.models.CircVisData.prototype._insertEdge,this.chromoData),function(a){return!_.isNull(a)})},vq.CircVis.prototype.addNodes=function(a){var b,c=this;_.isArray(a)?b=this.chromoData._insertNodes(a):b=this.chromoData._insertNodes([a]),b=_.reject(b,function(a){return _.isNull(a)}),_.each(_.uniq(_.pluck(b,"chr")),function(a){c._drawTicks(a),c._drawNetworkNodes(a),c._drawWedgeData(a)})},vq.CircVis.prototype.removeNodes=function(a){var b=this;_.isFunction(a)&&(a=_.filter(this.chromoData._network.nodes_array,a)),_.isArray(a)?(_.each(a,function(a){b.chromoData._removeNode(a)}),this.chromoData._retileNodes(),_.each(_.uniq(_.pluck(a,"chr")),function(a){b._drawTicks(a),b._drawNetworkNodes(a),b._drawWedgeData(a)})):_.isObject(a)&&(b.chromoData._removeNode(a),b._drawTicks(a.chr),b._drawNetworkNodes(a.chr),b._drawWedgeData(a.chr))},vq.CircVis.prototype._edgeListToNodeList=function(a){return _.uniq(_.flatten(_.chain(a).map(function(a){return[a.source,a.target]}).value()))}